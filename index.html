<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Who is the Spy? | Secure Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Noto+Sans+Arabic:wght@400;700;900&display=swap');
        
        :root {
            --primary: #3b82f6;
            --spy-red: #ef4444;
            --bg-dark: #020617;
        }

        body { 
            background-color: var(--bg-dark); 
            color: #f8fafc;
            font-family: 'Plus Jakarta Sans', 'Noto Sans Arabic', sans-serif;
            margin: 0;
            overflow-x: hidden;
            background-image: radial-gradient(circle at top right, #1e1b4b 0%, #020617 60%);
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Enhanced Animations */
        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(30px); filter: blur(10px); } 
            to { opacity: 1; transform: translateY(0); filter: blur(0); } 
        }
        .animate-slide-up { animation: slideUp 0.7s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade { animation: fadeIn 0.5s ease-out forwards; }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 15px rgba(59, 130, 246, 0.2); }
            50% { box-shadow: 0 0-30px rgba(59, 130, 246, 0.5); }
        }
        .active-glow { animation: pulse-glow 2s infinite; }

        .spy-gradient { background: linear-gradient(135deg, #450a0a 0%, #ef4444 100%); }
        .citizen-gradient { background: linear-gradient(135deg, #172554 0%, #3b82f6 100%); }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        .hover-scale { transition: transform 0.2s ease; }
        .hover-scale:hover { transform: scale(1.02); }
        .hover-scale:active { transform: scale(0.98); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyApAJaNfF0YHupunLRlK3jRYvttxczWShY",
            authDomain: "who-is-the-spy-919b9.firebaseapp.com",
            projectId: "who-is-the-spy-919b9",
            storageBucket: "who-is-the-spy-919b9.firebasestorage.app",
            messagingSenderId: "607075438373",
            appId: "1:607075438373:web:a03e9fb8b243cd993e14cc"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'spy_pro_ultra_secure';
        const GEMINI_KEY = "AIzaSyCXlSHuuwmLXcykV93V5hGsflpYn9yyNAg"; 

        const TRANSLATIONS = {
            en: {
                title: "WHO IS THE SPY?",
                subtitle: "SECURE NETWORK v2.0",
                nickname: "Operator Name",
                create: "Establish HQ",
                join: "Infiltrate",
                roomCode: "Access Key",
                players: "Active Agents",
                start: "Start Mission",
                spy: "STRIKE TEAM: SPY",
                spyDesc: "Mission parameters hidden. Infiltrate and survive.",
                citizen: "STRIKE TEAM: CITIZEN",
                citizenDesc: "Identify the anomaly in the group.",
                location: "Mission Objective",
                vote: "Identify Anomaly",
                voteDesc: "Select the data point that fits the objective.",
                timer: "Lockdown in:",
                sec: "s",
                results: "Consensus Data",
                newRound: "Re-deploy",
                copied: "Copied!",
                copy: "Copy",
                waiting: "Waiting for Lead Agent...",
                loading: "Booting System...",
                spyBlock: "ENCRYPTED DATA",
                spyHelp: "Observe transmissions from other agents to deduce objective."
            },
            ar: {
                title: "ŸÖŸÜ ŸáŸà ÿßŸÑÿ¨ÿßÿ≥Ÿàÿ≥ÿü",
                subtitle: "ÿßŸÑÿ¥ÿ®ŸÉÿ© ÿßŸÑŸÖÿ§ŸÖŸÜÿ© v2.0",
                nickname: "ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ",
                create: "ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸÇÿ±",
                join: "ÿßÿÆÿ™ÿ±ÿßŸÇ ÿßŸÑÿ∫ÿ±ŸÅÿ©",
                roomCode: "ŸÖŸÅÿ™ÿßÿ≠ ÿßŸÑÿØÿÆŸàŸÑ",
                players: "ÿßŸÑÿπŸÖŸÑÿßÿ° ÿßŸÑŸÖÿ™ÿµŸÑŸàŸÜ",
                start: "ÿ®ÿØÿ° ÿßŸÑÿπŸÖŸÑŸäÿ©",
                spy: "ŸÅÿ±ŸäŸÇ ÿßŸÑŸáÿ¨ŸàŸÖ: ÿ¨ÿßÿ≥Ÿàÿ≥",
                spyDesc: "ÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™ ÿßŸÑŸÖŸáŸÖÿ© ŸÖÿ≠ÿ¨Ÿàÿ®ÿ©. ÿßŸÜÿØŸÖÿ¨ ŸàŸÑÿß ÿ™ŸÜŸÉÿ¥ŸÅ.",
                citizen: "ŸÅÿ±ŸäŸÇ ÿßŸÑŸáÿ¨ŸàŸÖ: ŸÖŸàÿßÿ∑ŸÜ",
                citizenDesc: "ÿ≠ÿØÿØ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿØÿÆŸäŸÑ ŸÅŸä ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©.",
                location: "ŸáÿØŸÅ ÿßŸÑŸÖŸáŸÖÿ©",
                vote: "ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿØÿÆŸäŸÑ",
                voteDesc: "ÿßÿÆÿ™ÿ± ÿßŸÑŸÉŸÑŸÖÿ© ÿßŸÑÿ™Ÿä ÿ™ŸÜÿßÿ≥ÿ® ÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™ ÿßŸÑŸÖŸáŸÖÿ©.",
                timer: "ÿßŸÑÿ•ÿ∫ŸÑÿßŸÇ ÿÆŸÑÿßŸÑ:",
                sec: "ÿ´ÿßŸÜŸäÿ©",
                results: "ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ™ŸÅŸÇ ÿπŸÑŸäŸáÿß",
                newRound: "ÿ•ÿπÿßÿØÿ© ÿßŸÜÿ™ÿ¥ÿßÿ±",
                copied: "ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ!",
                copy: "ŸÜÿ≥ÿÆ",
                waiting: "ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ± ŸÇÿßÿ¶ÿØ ÿßŸÑÿπŸÖŸÑŸäÿ©...",
                loading: "ÿ¨ÿßÿ±Ÿä ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ...",
                spyBlock: "ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ¥ŸÅÿ±ÿ©",
                spyHelp: "ÿ±ÿßŸÇÿ® ÿ•ÿ¥ÿßÿ±ÿßÿ™ ÿßŸÑÿπŸÖŸÑÿßÿ° ÿßŸÑÿ¢ÿÆÿ±ŸäŸÜ ŸÑÿßÿ≥ÿ™ŸÜÿ™ÿßÿ¨ ÿßŸÑŸáÿØŸÅ."
            }
        };

        async function fetchScenario() {
            try {
                const prompt = "Generate a location and 4 related words. One word is the target, others are hints. Return JSON: {loc_ar, words_ar:[4], loc_en, words_en:[4]}";
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json" }
                    })
                });
                const data = await response.json();
                return JSON.parse(data.candidates[0].content.parts[0].text);
            } catch (e) {
                return { 
                    loc_ar: "ÿßŸÑŸÖÿ≥ÿ™ÿ¥ŸÅŸâ", words_ar: ["ÿ∑ÿ®Ÿäÿ®", "ÿØŸàÿßÿ°", "ŸÖÿ±Ÿäÿ∂", "ÿ¨ÿ±ÿßÿ≠ÿ©"], 
                    loc_en: "Hospital", words_en: ["Doctor", "Medicine", "Patient", "Surgery"] 
                };
            }
        }

        function App() {
            const [lang, setLang] = useState('ar');
            const [user, setUser] = useState(null);
            const [room, setRoom] = useState(null);
            const [roomId, setRoomId] = useState('');
            const [inputCode, setInputCode] = useState('');
            const [nickname, setNickname] = useState(localStorage.getItem('spy_nick') || '');
            const [loading, setLoading] = useState(false);
            const [timeLeft, setTimeLeft] = useState(0);
            const [copyStatus, setCopyStatus] = useState(false);

            const t = TRANSLATIONS[lang];

            useEffect(() => {
                const unsub = auth.onAuthStateChanged(async (u) => {
                    if (u) setUser(u);
                    else await auth.signInAnonymously();
                });
                return unsub;
            }, []);

            useEffect(() => {
                if (!user || !roomId) return;
                const ref = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId);
                const unsub = ref.onSnapshot(doc => {
                    if (doc.exists) setRoom(doc.data());
                    else setRoom(null);
                }, (error) => console.error(error));
                return unsub;
            }, [user, roomId]);

            useEffect(() => {
                let timer;
                if (room?.status === 'playing' && room?.timerStart) {
                    const update = () => {
                        const elapsed = Math.floor((Date.now() - room.timerStart) / 1000);
                        const remaining = Math.max(0, 30 - elapsed);
                        setTimeLeft(remaining);
                    };
                    update();
                    timer = setInterval(update, 1000);
                }
                return () => clearInterval(timer);
            }, [room?.status, room?.timerStart]);

            const handleCreate = async () => {
                if (!nickname.trim()) return;
                setLoading(true);
                const id = Math.random().toString(36).substring(2, 7).toUpperCase();
                const roomData = {
                    id, admin: user.uid, status: 'waiting',
                    players: [{ uid: user.uid, name: nickname, vote: null }],
                    scenario: null, spyId: null, timerStart: null
                };
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(id).set(roomData);
                setRoomId(id);
                setLoading(false);
            };

            const handleJoin = async () => {
                if (!nickname.trim() || !inputCode.trim()) return;
                setLoading(true);
                const code = inputCode.toUpperCase();
                const ref = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(code);
                const snap = await ref.get();
                if (snap.exists) {
                    const data = snap.data();
                    if (!data.players.find(p => p.uid === user.uid)) {
                        await ref.update({ players: [...data.players, { uid: user.uid, name: nickname, vote: null }] });
                    }
                    setRoomId(code);
                }
                setLoading(false);
            };

            const startMission = async () => {
                if (room.admin !== user.uid) return;
                setLoading(true);
                const scenario = await fetchScenario();
                const spy = room.players[Math.floor(Math.random() * room.players.length)];
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({
                    status: 'playing',
                    scenario,
                    spyId: spy.uid,
                    timerStart: Date.now(),
                    players: room.players.map(p => ({ ...p, vote: null }))
                });
                setLoading(false);
            };

            const castVote = async (word) => {
                if (timeLeft <= 0 || room.spyId === user.uid) return; 
                const updated = room.players.map(p => p.uid === user.uid ? { ...p, vote: word } : p);
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({ players: updated });
            };

            const copyCode = () => {
                const el = document.createElement('textarea');
                el.value = roomId;
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
                setCopyStatus(true);
                setTimeout(() => setCopyStatus(false), 2000);
            };

            const consensus = useMemo(() => {
                if (!room?.players) return null;
                const votes = room.players.map(p => p.vote).filter(v => v);
                if (!votes.length) return null;
                const counts = votes.reduce((a, v) => { a[v] = (a[v] || 0) + 1; return a; }, {});
                return Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
            }, [room]);

            if (!user) return <div className="h-screen flex items-center justify-center font-black animate-pulse text-blue-500 tracking-tighter uppercase">{t.loading}</div>;

            const isSpy = room?.spyId === user.uid;

            return (
                <div className="min-h-screen p-4 md:p-8 flex flex-col items-center" dir={lang === 'ar' ? 'rtl' : 'ltr'}>
                    <div className="w-full max-w-lg space-y-6">
                        
                        {/* Header Section */}
                        <div className="flex justify-between items-center animate-fade">
                            <div className="animate-slide-up">
                                <h1 className="text-3xl font-[900] tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-500 leading-none">
                                    {t.title}
                                </h1>
                                <p className="text-[10px] uppercase tracking-widest opacity-40 font-bold mt-1">{t.subtitle}</p>
                            </div>
                            <button 
                                onClick={() => setLang(lang === 'en' ? 'ar' : 'en')}
                                className="glass-panel px-4 py-2 text-[10px] font-black hover:bg-white/10 active:scale-95 transition-all"
                            >
                                {lang === 'en' ? 'AR' : 'EN'}
                            </button>
                        </div>

                        {!room ? (
                            <div className="glass-panel p-8 space-y-8 shadow-2xl animate-slide-up" style={{animationDelay: '0.1s'}}>
                                <div className="space-y-3">
                                    <label className="text-[10px] uppercase font-black opacity-30 px-1">{t.nickname}</label>
                                    <input 
                                        className="w-full bg-white/5 border border-white/10 p-4 rounded-2xl font-bold focus:border-blue-500 outline-none transition-all focus:ring-4 focus:ring-blue-500/10"
                                        placeholder="..."
                                        value={nickname}
                                        onChange={e => { setNickname(e.target.value); localStorage.setItem('spy_nick', e.target.value); }}
                                    />
                                </div>

                                <div className="grid grid-cols-1 gap-4">
                                    <button 
                                        onClick={handleCreate}
                                        disabled={loading || !nickname}
                                        className="w-full bg-blue-600 hover:bg-blue-500 py-5 rounded-2xl font-black text-lg transition-all hover-scale shadow-lg shadow-blue-900/40 disabled:opacity-50"
                                    >
                                        {t.create}
                                    </button>
                                    
                                    <div className="relative py-2 flex items-center">
                                        <div className="flex-grow border-t border-white/5"></div>
                                        <span className="flex-shrink mx-4 text-[10px] font-black opacity-20">OR</span>
                                        <div className="flex-grow border-t border-white/5"></div>
                                    </div>

                                    <div className="flex gap-2">
                                        <input 
                                            className="flex-1 bg-white/5 border border-white/10 p-4 rounded-2xl font-mono text-center font-black tracking-widest focus:border-indigo-500 outline-none transition-all uppercase"
                                            placeholder="CODE"
                                            value={inputCode}
                                            onChange={e => setInputCode(e.target.value.toUpperCase())}
                                        />
                                        <button 
                                            onClick={handleJoin}
                                            disabled={loading || !nickname || !inputCode}
                                            className="bg-white/5 border border-white/10 hover:bg-white/10 px-8 rounded-2xl font-black transition-all hover-scale disabled:opacity-50"
                                        >
                                            {t.join}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-6">
                                {/* Room Info Bar */}
                                <div className="glass-panel p-4 flex justify-between items-center animate-slide-up">
                                    <div className="flex gap-3 items-center">
                                        <div className="flex flex-col">
                                            <span className="text-[9px] uppercase font-black opacity-30 leading-none mb-1">{t.roomCode}</span>
                                            <div className="flex items-center gap-2">
                                                <span className="text-xl font-black text-blue-400 font-mono tracking-tighter">{room.id}</span>
                                                <button 
                                                    onClick={copyCode}
                                                    className={`p-1.5 rounded-lg text-[9px] font-black uppercase transition-all ${copyStatus ? 'bg-green-500 text-white' : 'bg-white/10 hover:bg-white/20'}`}
                                                >
                                                    {copyStatus ? t.copied : t.copy}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-end">
                                        <span className="text-[9px] uppercase font-black opacity-30 leading-none mb-1">{t.players}</span>
                                        <span className="text-xl font-black">{room.players.length}</span>
                                    </div>
                                </div>

                                {room.status === 'waiting' ? (
                                    <div className="glass-panel p-6 space-y-6 animate-slide-up" style={{animationDelay: '0.15s'}}>
                                        <div className="grid grid-cols-2 gap-3 max-h-64 overflow-y-auto custom-scrollbar pr-2">
                                            {room.players.map((p, i) => (
                                                <div key={i} className={`p-4 rounded-2xl border flex items-center gap-3 animate-fade ${p.uid === user.uid ? 'bg-blue-500/10 border-blue-500/30 active-glow' : 'bg-white/5 border-transparent'}`}>
                                                    <div className={`w-2 h-2 rounded-full ${p.uid === user.uid ? 'bg-blue-400' : 'bg-white/20'}`}></div>
                                                    <span className="font-black text-xs truncate">{p.name}</span>
                                                    {p.uid === room.admin && <span className="text-[10px] ml-auto">üëë</span>}
                                                </div>
                                            ))}
                                        </div>
                                        
                                        {room.admin === user.uid ? (
                                            <button 
                                                onClick={startMission}
                                                disabled={loading || room.players.length < 3}
                                                className="w-full bg-green-600 hover:bg-green-500 py-4 rounded-2xl font-black text-lg transition-all hover-scale shadow-lg shadow-green-900/20 disabled:opacity-50"
                                            >
                                                {t.start}
                                            </button>
                                        ) : (
                                            <div className="text-center py-4 text-[10px] font-black opacity-30 animate-pulse tracking-widest uppercase">
                                                {t.waiting}
                                            </div>
                                        )}
                                    </div>
                                ) : (
                                    <div className="space-y-6 animate-fade">
                                        {/* Identity Reveal Card */}
                                        <div className={`p-10 rounded-[2.5rem] border-b-[10px] shadow-2xl text-center relative overflow-hidden animate-slide-up ${isSpy ? 'spy-gradient border-red-900' : 'citizen-gradient border-blue-900'}`}>
                                            <div className="relative z-10 space-y-4">
                                                <div className="text-6xl drop-shadow-lg">{isSpy ? 'üïµÔ∏è' : 'üèôÔ∏è'}</div>
                                                <div>
                                                    <h2 className="text-3xl font-[900] tracking-tighter mb-1 uppercase">
                                                        {isSpy ? t.spy : t.citizen}
                                                    </h2>
                                                    <p className="text-[10px] font-bold opacity-70 uppercase tracking-[0.2em]">{isSpy ? t.spyDesc : t.citizenDesc}</p>
                                                </div>
                                                
                                                <div className="h-[2px] bg-white/10 w-24 mx-auto my-6"></div>

                                                {!isSpy ? (
                                                    <div className="space-y-2">
                                                        <span className="text-[9px] font-black uppercase tracking-[0.3em] opacity-50">{t.location}</span>
                                                        <div className="text-5xl font-black tracking-tighter animate-slide-up bg-clip-text text-transparent bg-gradient-to-b from-white to-white/60">
                                                            {lang === 'ar' ? room.scenario?.loc_ar : room.scenario?.loc_en}
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="space-y-3 bg-black/20 p-6 rounded-3xl border border-white/5 animate-pulse">
                                                        <span className="text-[10px] font-black uppercase tracking-[0.2em] text-red-300">{t.spyBlock}</span>
                                                        <p className="text-xs italic font-medium opacity-80 leading-relaxed px-4">{t.spyHelp}</p>
                                                    </div>
                                                )}
                                            </div>
                                        </div>

                                        {/* Voting Section - HARD SECURED */}
                                        <div className="glass-panel p-8 space-y-6 animate-slide-up" style={{animationDelay: '0.1s'}}>
                                            <div className="flex justify-between items-end">
                                                <div>
                                                    <h3 className="font-black text-xl tracking-tight">{t.vote}</h3>
                                                    <p className="text-[10px] opacity-30 font-bold uppercase tracking-widest">{t.voteDesc}</p>
                                                </div>
                                                {timeLeft > 0 && (
                                                    <div className="text-right">
                                                        <span className="text-3xl font-black font-mono tracking-tighter text-blue-500">{timeLeft}{t.sec}</span>
                                                    </div>
                                                )}
                                            </div>

                                            <div className="grid grid-cols-2 gap-4">
                                                {/* Logic Check: If Spy, DO NOT map words, show a single placeholder instead */}
                                                {!isSpy ? (
                                                    (lang === 'ar' ? room.scenario?.words_ar : room.scenario?.words_en)?.map((word, idx) => {
                                                        const myVote = room.players.find(p => p.uid === user.uid)?.vote === word;
                                                        const votesForThis = room.players.filter(p => p.vote === word);

                                                        return (
                                                            <button 
                                                                key={idx}
                                                                onClick={() => castVote(word)}
                                                                disabled={timeLeft <= 0}
                                                                className={`p-5 rounded-2xl border-2 text-sm font-black transition-all relative overflow-hidden hover-scale ${myVote ? 'bg-white text-black border-white active-glow' : 'bg-white/5 border-white/5 hover:border-white/20'}`}
                                                            >
                                                                {word}
                                                                <div className="absolute bottom-2 right-2 flex gap-1">
                                                                    {votesForThis.map((v, vi) => (
                                                                        <div key={vi} className="w-1.5 h-1.5 rounded-full bg-blue-500 animate-fade"></div>
                                                                    ))}
                                                                </div>
                                                            </button>
                                                        );
                                                    })
                                                ) : (
                                                    // Spy View: Completely redacted grid
                                                    Array(4).fill(0).map((_, idx) => (
                                                        <div key={idx} className="p-8 rounded-2xl bg-white/5 border border-white/5 flex items-center justify-center opacity-40">
                                                            <div className="h-2 w-16 bg-white/20 rounded-full"></div>
                                                        </div>
                                                    ))
                                                )}
                                            </div>

                                            {timeLeft <= 0 && consensus && !isSpy && (
                                                <div className="mt-4 p-5 rounded-2xl bg-blue-500/10 border border-blue-500/20 text-center animate-slide-up">
                                                    <span className="text-[10px] font-black uppercase text-blue-400 block mb-1">{t.results}</span>
                                                    <div className="text-3xl font-black text-blue-300 tracking-tighter">{consensus}</div>
                                                </div>
                                            )}

                                            {room.admin === user.uid && timeLeft <= 0 && (
                                                <button 
                                                    onClick={startMission}
                                                    className="w-full bg-white/5 hover:bg-white/10 py-4 rounded-2xl font-black text-xs transition-all uppercase tracking-[0.3em] animate-fade border border-white/5 mt-4"
                                                >
                                                    üîÑ {t.newRound}
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        <div className="text-center opacity-10 font-mono text-[9px] uppercase tracking-[1em] py-8">
                            STRIKE.NET.SECURED.READY
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
