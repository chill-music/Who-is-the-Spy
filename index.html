<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PRO SPY | Covert Arena</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üïµÔ∏è</text></svg>">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #05050a;
            --bg-card: rgba(20, 20, 30, 0.85);
            --primary: #00f2ff;
            --secondary: #7000ff;
            --accent: #ff0055;
            --text-main: #ffffff;
            --text-muted: #8b8b9e;
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body { 
            background-color: var(--bg-dark); 
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .glass-panel {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        .font-tech { font-family: 'Rajdhani', sans-serif; }

        @keyframes pulse-glow {
            0% { text-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary); }
            50% { text-shadow: 0 0 20px var(--primary), 0 0 40px var(--primary), 0 0 60px var(--secondary); }
            100% { text-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary); }
        }

        @keyframes rotate-border {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .animate-fade-in { animation: fade-in-up 0.6s ease-out forwards; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        
        .logo-container {
            position: relative;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .logo-border {
            position: absolute;
            inset: 0;
            border-radius: 12px;
            border: 2px solid transparent;
            border-top-color: var(--primary);
            border-right-color: var(--secondary);
            animation: rotate-border 3s linear infinite;
        }

        .game-title {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            letter-spacing: 2px;
            background: linear-gradient(to right, #fff, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: pulse-glow 3s infinite alternate;
        }

        .btn-neon {
            position: relative;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            color: white;
            font-weight: 700;
            transition: all 0.3s;
            overflow: hidden;
        }
        
        .btn-neon:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 20px var(--primary);
        }
        
        .btn-neon:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .btn-ghost {
            background: transparent;
            border: 1px solid var(--border);
            transition: 0.3s;
        }
        .btn-ghost:hover { border-color: var(--primary); color: var(--primary); }

        .input-dark {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--border);
            color: white;
            transition: 0.2s;
        }
        .input-dark:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.2);
        }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--secondary); border-radius: 2px; }

        .player-card { transition: all 0.3s; position: relative; }
        .player-card.active {
            border: 1px solid var(--primary);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
            background: rgba(0, 242, 255, 0.1);
        }

        .player-card.eliminated {
            opacity: 0.4;
            border-color: var(--accent);
            filter: grayscale(100%);
        }

        .player-timer-svg { 
            transform: rotate(-90deg); 
            width: 24px; 
            height: 24px;
            position: absolute;
            left: -12px;
            top: 50%;
            margin-top: -12px;
            z-index: 10;
        }
        .player-timer-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 3; }
        .player-timer-progress { fill: none; stroke: var(--primary); stroke-width: 3; stroke-linecap: round; transition: stroke-dashoffset 1s linear; }
        .player-timer-text {
            position: absolute;
            left: -12px;
            top: 50%;
            width: 24px;
            height: 24px;
            margin-top: -12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: bold;
            color: var(--primary);
            z-index: 11;
        }

        .chat-bubble-me {
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            border-radius: 18px 18px 4px 18px;
            padding: 8px 12px;
            max-width: 80%;
            align-self: flex-end;
            word-wrap: break-word;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .chat-bubble-other {
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            border-radius: 18px 18px 18px 4px;
            padding: 8px 12px;
            max-width: 80%;
            align-self: flex-start;
            word-wrap: break-word;
        }
        
        .identity-square {
            width: 100%;
            max-width: 280px;
            aspect-ratio: 1 / 1; 
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        .identity-spy {
            border: 2px solid var(--accent);
            background: radial-gradient(circle at center, rgba(255, 0, 85, 0.15), transparent 70%);
            box-shadow: 0 0 40px rgba(255, 0, 85, 0.3);
        }
        
        .identity-agent {
            border: 2px solid #10b981;
            background: radial-gradient(circle at center, rgba(16, 185, 129, 0.1), transparent 70%);
            box-shadow: 0 0 40px rgba(16, 185, 129, 0.2);
        }

        .emoji-btn {
            font-size: 18px;
            padding: 5px;
            cursor: pointer;
            transition: transform 0.2s;
            filter: grayscale(100%);
            opacity: 0.7;
        }
        .emoji-btn:hover {
            transform: scale(1.4);
            filter: grayscale(0%);
            opacity: 1;
        }

        /* Word Selection Grid */
        .word-vote-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            transition: all 0.3s;
            position: relative;
        }
        .word-vote-card.selected {
            border-color: var(--primary);
            background: rgba(0, 242, 255, 0.1);
            transform: scale(1.02);
        }
        .voter-name {
            position: absolute;
            bottom: -8px;
            right: 10px;
            font-size: 10px;
            background: var(--secondary);
            padding: 2px 6px;
            border-radius: 8px;
            color: white;
        }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>
    <div id="root"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyApAJaNfF0YHupunLRlK3jRYvttxczWShY",
            authDomain: "who-is-the-spy-919b9.firebaseapp.com",
            projectId: "who-is-the-spy-919b9",
            storageBucket: "who-is-the-spy-919b9.firebasestorage.app",
            messagingSenderId: "607075438373",
            appId: "1:607075438373:web:a03e9fb8b243cd993e14cc"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const appId = 'pro_spy_v8_final';

        // --- Sound System ---
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null; 

        const initAudio = () => {
            if (!audioCtx) audioCtx = new AudioCtx();
        };
        
        const playSound = (type) => {
            if (!audioCtx) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            if (type === 'click') {
                osc.frequency.value = 800;
                osc.type = 'sine';
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            } else if (type === 'success') {
                osc.frequency.value = 600;
                osc.type = 'sine';
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                osc.frequency.linearRampToValueAtTime(1200, audioCtx.currentTime + 0.15);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'fail') {
                osc.frequency.value = 200;
                osc.type = 'sawtooth';
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.4);
            }
        };

        // --- Translations ---
        const TRANSLATIONS = {
            en: {
                appName: "PRO SPY", tagline: "COVERT ARENA",
                nickname: "OPERATOR NAME", create: "CREATE LOBBY", join: "JOIN OPS",
                codePlaceholder: "ENTER CODE", players: "OPERATIVES", start: "LAUNCH MISSION",
                langBtn: "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©", loading: "PROCESSING...", you: "YOU",
                statusSpy: "SPY", statusAgent: "AGENT",
                round: "ROUND", discussionTime: "DISCUSSION TIME",
                skip: "SKIP TURN", vote: "VOTE TO EJECT",
                chatPlaceholder: "Type message...", send: "SEND",
                waiting: "Awaiting host...", location: "LOCATION",
                spectator: "SPECTATOR", ejected: "EJECTED",
                noChoice: "NO VOTE", confirm: "CONFIRM VOTE", gameOver: "GAME OVER",
                spyWin: "SPY WINS!", agentsWin: "AGENTS WIN!",
                playAgain: "PLAY AGAIN", connecting: "Establishing Secure Connection...",
                voteWait: "Waiting for votes...", voteDone: "VOTE LOCKED", soundOn: "SOUND ON", soundOff: "SOUND OFF",
                linkGuessCard: "GUESS MY CARD",
                // New
                wordSelectionTitle: "SELECT KEYWORD",
                wordSelectionDesc: "Choose a keyword for this round",
                finishSelection: "FINISH SELECTION",
                selectedWord: "Selected Keyword"
            },
            ar: {
                appName: "ÿ®ÿ±Ÿà ÿ¨ÿßÿ≥Ÿàÿ≥", tagline: "ÿ≥ÿßÿ≠ÿ© ÿßŸÑÿπŸÖŸÑŸäÿßÿ™",
                nickname: "ÿßÿ≥ŸÖ ÿßŸÑÿπŸÖŸäŸÑ", create: "ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑŸÖŸÇÿ±", join: "ÿßŸÜÿ∂ŸÖÿßŸÖ",
                codePlaceholder: "ÿ£ÿØÿÆŸÑ ÿßŸÑŸÉŸàÿØ", players: "ÿßŸÑÿπŸÖŸÑÿßÿ°", start: "ÿ®ÿØÿ° ÿßŸÑŸÖŸáŸÖÿ©",
                langBtn: "English", loading: "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...", you: "ÿ£ŸÜÿ™",
                statusSpy: "ÿ¨ÿßÿ≥Ÿàÿ≥", statusAgent: "ÿπŸÖŸäŸÑ",
                round: "ÿßŸÑÿ¨ŸàŸÑÿ©", discussionTime: "ŸàŸÇÿ™ ÿßŸÑŸÜŸÇÿßÿ¥",
                skip: "ÿ™ÿÆÿ∑Ÿä ÿßŸÑÿØŸàÿ±", vote: "ÿ™ÿµŸàŸäÿ™ ŸÑŸÑÿ∑ÿ±ÿØ",
                chatPlaceholder: "ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ©...", send: "ÿ•ÿ±ÿ≥ÿßŸÑ",
                waiting: "ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑŸÖÿ∂ŸäŸÅ...", location: "ÿßŸÑŸÖŸàŸÇÿπ",
                spectator: "ŸÖÿ¥ÿßŸáÿØ", ejected: "ŸÖÿ∑ÿ±ŸàÿØ",
                noChoice: "ŸÑŸÖ ŸäÿµŸàÿ™", confirm: "ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿ™ÿµŸàŸäÿ™", gameOver: "ÿßŸÜÿ™Ÿáÿ™ ÿßŸÑŸÑÿπÿ®ÿ©",
                spyWin: "ŸÅÿßÿ≤ ÿßŸÑÿ¨ÿßÿ≥Ÿàÿ≥!", agentsWin: "ŸÅÿßÿ≤ ÿßŸÑÿπŸÖŸÑÿßÿ°!",
                playAgain: "ŸÑÿπÿ® ŸÖÿ¨ÿØÿØÿßŸã", connecting: "ÿ¨ÿßÿ±Ÿä ÿ™ÿ£ŸÖŸäŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ...",
                voteWait: "ÿ®ÿßŸÜÿ™ÿ∏ÿßÿ± ÿßŸÑÿ£ÿµŸàÿßÿ™...", voteDone: "ÿ™ŸÖ ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿ™ÿµŸàŸäÿ™", soundOn: "ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™", soundOff: "ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿµŸàÿ™",
                linkGuessCard: "ÿÆŸÖŸÜ ŸÉÿ±ÿ™Ÿä",
                // New
                wordSelectionTitle: "ÿßÿÆÿ™ÿ± ŸÉŸÑŸÖÿ© ÿßŸÑÿ≥ÿ±",
                wordSelectionDesc: "ÿßÿÆÿ™ÿ± ŸÉŸÑŸÖÿ© ÿ≥ÿ± ŸÑŸáÿ∞Ÿá ÿßŸÑÿ¨ŸàŸÑÿ©",
                finishSelection: "ÿ•ŸÜŸáÿßÿ° ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±",
                selectedWord: "ŸÉŸÑŸÖÿ© ÿßŸÑÿ≥ÿ±"
            }
        };

        // --- Scenarios DB (Expanded > 50) ---
        const SCENARIOS = [
            { loc_ar: "ŸÖÿ≠ÿ∑ÿ© ŸÅÿ∂ÿßÿ°", words_ar: ["ŸÅÿ∂ÿßÿ°", "ÿµÿßÿ±ŸàÿÆ", "zero-g", "ŸÇŸÖÿ±"], loc_en: "Space Station", words_en: ["Space", "Rocket", "Zero-g", "Moon"] },
            { loc_ar: "ÿ∫Ÿàÿßÿµÿ© ŸÜŸàŸàŸäÿ©", words_ar: ["ÿπŸÖŸÇ", "ŸÖÿßÿ°", "ÿ∂ÿ∫ÿ∑", "ÿ≥ŸàŸÜÿßÿ±"], loc_en: "Nuclear Submarine", words_en: ["Depth", "Water", "Pressure", "Sonar"] },
            { loc_ar: "ŸÇÿµÿ± ŸÖŸÑŸÉŸä", words_ar: ["ÿ™ÿßÿ¨", "ÿ≠ÿ±ÿßÿ≥", "ÿπÿ±Ÿàÿ¥", "ÿÆÿØŸÖ"], loc_en: "Royal Palace", words_en: ["Crown", "Guards", "Throne", "Servants"] },
            { loc_ar: "ÿ®ŸÜŸÉ ŸÖÿ±ŸÉÿ≤Ÿä", words_ar: ["ÿÆÿ≤ŸÜÿ©", "ŸÖÿßŸÑ", "ÿ±ÿµÿßÿµ", "ŸÖŸÅÿ™ÿßÿ≠"], loc_en: "Central Bank", words_en: ["Vault", "Money", "Lead", "Key"] },
            { loc_ar: "ŸÖÿ≥ÿ™ÿ¥ŸÅŸâ ŸÖŸáÿ¨Ÿàÿ±", words_ar: ["ÿ£ÿ¥ÿ®ÿßÿ≠", "ÿ£ÿ∑ÿ®ÿßÿ°", "ÿ∏ŸÑÿßŸÖ", "ÿ≠ŸÇŸÜ"], loc_en: "Abandoned Hospital", words_en: ["Ghosts", "Doctors", "Dark", "Syringe"] },
            { loc_ar: "ŸÇÿ∑ÿßÿ± ŸÑŸäŸÑŸä", words_ar: ["ÿØÿ±ÿ¨ÿßÿ™", "ÿ™ÿ∞ÿßŸÉÿ±", "ŸÜŸàŸÖ", "ŸÖŸÖÿ±"], loc_en: "Night Train", words_en: ["Bunks", "Tickets", "Sleep", "Aisle"] },
            { loc_ar: "ÿ¨ÿ≤Ÿäÿ±ÿ© ŸÉŸÜÿ≤", words_ar: ["ÿÆÿ±Ÿäÿ∑ÿ©", "ÿ≠ŸÅÿ±", "ÿ∞Ÿáÿ®", "ŸÇÿ±ÿßÿµŸÜÿ©"], loc_en: "Treasure Island", words_en: ["Map", "Dig", "Gold", "Pirates"] },
            { loc_ar: "ŸÖÿµŸÜÿπ ÿ±Ÿàÿ®Ÿàÿ™ÿßÿ™", words_ar: ["ÿ£ÿ≥ŸÑÿßŸÉ", "ÿµŸäÿßŸÜÿ©", "ÿ®ÿ±ŸÖÿ¨ÿ©", "ŸÖÿπÿßÿØŸÜ"], loc_en: "Robot Factory", words_en: ["Wires", "Maintenance", "Coding", "Metal"] },
            { loc_ar: "ŸÖÿ∑ÿßÿ± ÿØŸàŸÑŸä", words_ar: ["ÿ¨Ÿàÿßÿ≤ÿßÿ™", "ÿ∑ÿßÿ¶ÿ±ÿßÿ™", "ÿ≠ŸÇÿßÿ¶ÿ®", "ÿ•ŸÇŸÑÿßÿπ"], loc_en: "Airport", words_en: ["Passports", "Planes", "Bags", "Takeoff"] },
            { loc_ar: "ÿ¨ÿßŸÖÿπÿ© ÿ≥ÿ≠ÿ±", words_ar: ["ŸÉÿ™ÿ®", "ÿπÿµÿß", "ÿπŸÅÿßÿ±Ÿäÿ™", "ÿ™ÿ±ÿßŸÉŸäÿ®"], loc_en: "Magic Uni", words_en: ["Books", "Wand", "Ghosts", "Potions"] },
            { loc_ar: "ÿ≥ŸÅŸäŸÜÿ© ŸÇÿ±ÿßÿµŸÜÿ©", words_ar: ["ÿ¥ÿ±ÿßÿπ", "ŸÖÿØŸÅÿπ", "ÿ∑ŸàŸÇ", "ÿÆÿ¥ÿ®"], loc_en: "Pirate Ship", words_en: ["Sail", "Cannon", "Parrot", "Wood"] },
            { loc_ar: "ŸÖÿ±ŸÉÿ≤ ÿ¥ÿ±ÿ∑ÿ©", words_ar: ["ŸÇÿ∂ÿ®ÿßŸÜ", "ÿ¥ÿ±ÿ∑Ÿä", "ÿ≥Ÿäÿßÿ±ÿ©", "ŸÇÿßŸÜŸàŸÜ"], loc_en: "Police Station", words_en: ["Bars", "Cop", "Car", "Law"] },
            { loc_ar: "ŸÖÿØÿ±ÿ≥ÿ© ÿ´ÿßŸÜŸàŸäÿ©", words_ar: ["ÿ∑ÿßŸÑÿ®", "ÿ≠ŸÇŸäÿ®ÿ©", "ÿ≥ÿ®Ÿàÿ±ÿ©", "ÿ¨ÿ±ÿ≥"], loc_en: "High School", words_en: ["Student", "Bag", "Board", "Bell"] },
            { loc_ar: "ŸÖÿ∑ÿπŸÖ ŸÅÿßÿÆÿ±", words_ar: ["ŸÜÿßÿØŸÑ", "ŸÇÿßÿ¶ŸÖÿ©", "ŸÖŸÜÿØŸäŸÑ", "ÿ¥ŸàŸÉÿ©"], loc_en: "Fancy Restaurant", words_en: ["Waiter", "Menu", "Napkin", "Fork"] },
            { loc_ar: "ÿ¥ÿßÿ∑ÿ¶ ÿßÿ≥ÿ™Ÿàÿßÿ¶Ÿä", words_ar: ["ÿ±ŸÖŸÑ", "ŸÖŸàÿ¨ÿ©", "ÿ¥ŸÖÿ≥", "ŸÉŸàŸÉÿ™ŸäŸÑ"], loc_en: "Tropical Beach", words_en: ["Sand", "Wave", "Sun", "Cocktail"] },
            { loc_ar: "ŸÖÿπÿ±ÿ∂ ŸÅŸÜŸä", words_ar: ["ŸÑŸàÿ≠ÿ©", "ÿ™ŸÖÿ´ÿßŸÑ", "ÿ•ÿ∑ÿßÿ±", "ŸÖÿµŸàÿ±"], loc_en: "Art Gallery", words_en: ["Painting", "Statue", "Frame", "Photographer"] },
            { loc_ar: "ÿ≠ÿØŸäŸÇÿ© ÿ≠ŸäŸàÿßŸÜ", words_ar: ["ŸÇŸÅÿµ", "ÿ£ÿ≥ÿØ", "ÿ≤ÿßÿ¶ÿ±", "ÿ∑ÿπÿßŸÖ"], loc_en: "Zoo", words_en: ["Cage", "Lion", "Visitor", "Food"] },
            { loc_ar: "ŸÖŸÑÿπÿ® ŸÉÿ±ÿ© ŸÇÿØŸÖ", words_ar: ["ÿ≠ŸÉŸÖ", "ŸáÿØŸÅ", "ÿ¨ŸÖŸáŸàÿ±", "ÿπÿ¥ÿ®"], loc_en: "Stadium", words_en: ["Referee", "Goal", "Crowd", "Grass"] },
            { loc_ar: "ÿØÿßÿ± ŸÖÿ≥ŸÜŸäŸÜ", words_ar: ["ÿ≥ÿ±Ÿäÿ±", "ÿ∑ÿ®Ÿäÿ®", "ÿπŸÉÿßÿ≤", "ŸáÿØŸàÿ°"], loc_en: "Nursing Home", words_en: ["Bed", "Doctor", "Cane", "Quiet"] },
            { loc_ar: "ŸÖÿ≠ÿ∑ÿ© ŸàŸÇŸàÿØ", words_ar: ["ÿ®ŸÜÿ≤ŸäŸÜ", "ÿ≥Ÿäÿßÿ±ÿ©", "ŸÖÿ∂ÿÆÿ©", "ÿ≤Ÿäÿ™"], loc_en: "Gas Station", words_en: ["Gas", "Car", "Pump", "Oil"] },
            { loc_ar: "ŸÖŸÉÿ™ÿ®ÿ© ÿπÿßŸÖÿ©", words_ar: ["ŸÉÿ™ÿßÿ®", "ÿµŸÖÿ™", "ÿ±ŸÅ", "ŸÖŸÉÿ™ÿ®"], loc_en: "Library", words_en: ["Book", "Silence", "Shelf", "Desk"] },
            { loc_ar: "ŸÖÿµÿ≠ÿ© ŸÜŸÅÿ≥Ÿäÿ©", words_ar: ["ÿ¨ŸÜŸàŸÜ", "ÿ≠ÿ®Ÿàÿ®", "ÿ∑ÿ®Ÿäÿ®", "ÿ∫ÿ±ŸÅÿ©"], loc_en: "Asylum", words_en: ["Madness", "Pills", "Doctor", "Room"] },
            { loc_ar: "ŸÖÿÆÿ™ÿ®ÿ± ŸÉŸäŸÖŸäÿßÿ¶Ÿä", words_ar: ["ÿ£ŸÜÿ®Ÿàÿ®", "ÿ≥ÿßÿ¶ŸÑ", "ÿ™ŸÅÿßÿπŸÑ", "ÿ∫ÿßÿ≤"], loc_en: "Chem Lab", words_en: ["Tube", "Liquid", "Reaction", "Gas"] },
            { loc_ar: "ŸÖÿ≥ÿ±ÿ≠", words_ar: ["ÿ≥ÿ™ÿßÿ±", "ŸÖŸÖÿ´ŸÑ", "ŸÖŸÇÿπÿØ", "ÿ•ÿ∂ÿßÿ°ÿ©"], loc_en: "Theater", words_en: ["Curtain", "Actor", "Seat", "Light"] },
            { loc_ar: "ŸÅŸÜÿØŸÇ 5 ŸÜÿ¨ŸàŸÖ", words_ar: ["ÿ∫ÿ±ŸÅÿ©", "ŸÖŸÅÿ™ÿßÿ≠", "ÿßÿ≥ÿ™ŸÇÿ®ÿßŸÑ", "ÿ¨ŸÜÿßÿ≠"], loc_en: "Hotel", words_en: ["Room", "Key", "Reception", "Suite"] },
            { loc_ar: "ÿ≥ÿ¨ŸÜ", words_ar: ["ÿ≤ŸÜÿ≤ÿßŸÜÿ©", "ÿ≠ÿßÿ±ÿ≥", "ŸÇÿ∂ÿ®ÿßŸÜ", "Ÿáÿ±Ÿàÿ®"], loc_en: "Prison", words_en: ["Cell", "Guard", "Bars", "Escape"] },
            { loc_ar: "ŸÖÿµŸÜÿπ ÿ¥ŸàŸÉŸàŸÑÿßÿ™ÿ©", words_ar: ["ŸÉÿßŸÉÿßŸà", "ÿ≥ŸÉÿ±", "ŸÇÿßŸÑÿ®", "ÿ≠ŸÑŸàŸâ"], loc_en: "Chocolate Factory", words_en: ["Cocoa", "Sugar", "Mold", "Candy"] },
            { loc_ar: "ŸÖÿ≤ÿ±ÿπÿ©", words_ar: ["ÿ®ŸÇÿ±ÿ©", "ÿ≠ÿµÿßÿØ", "ÿ™ÿ±ÿßŸÉÿ™Ÿàÿ±", "ÿ®ÿ¶ÿ±"], loc_en: "Farm", words_en: ["Cow", "Harvest", "Tractor", "Well"] },
            { loc_ar: "ÿ≥ŸÅÿßÿ±ÿ©", words_ar: ["ÿ¨Ÿàÿßÿ≤", "ÿ≥ŸÅŸäÿ±", "ÿ™ÿ£ÿ¥Ÿäÿ±ÿ©", "ÿπŸÑŸÖ"], loc_en: "Embassy", words_en: ["Passport", "Ambassador", "Visa", "Flag"] },
            { loc_ar: "ŸÖÿ§ÿ™ŸÖÿ± ÿµÿ≠ŸÅŸä", words_ar: ["ŸÖŸäŸÉÿ±ŸàŸÅŸàŸÜ", "ÿµÿ≠ŸÅŸä", "ŸÉÿßŸÖŸäÿ±ÿß", "ÿ£ÿ≥ÿ¶ŸÑÿ©"], loc_en: "Press Conf", words_en: ["Mic", "Journalist", "Camera", "Questions"] },
            { loc_ar: "ÿ∫ÿ±ŸÅÿ© ÿπŸÖŸÑŸäÿßÿ™", words_ar: ["ÿ¥ÿßÿ¥ÿ©", "ÿÆÿ±Ÿäÿ∑ÿ©", "ÿ¨ŸÜŸàÿØ", "ÿÆÿ∑ÿ©"], loc_en: "War Room", words_en: ["Screen", "Map", "Soldiers", "Plan"] },
            { loc_ar: "ŸÖÿ≠ÿ∑ÿ© ŸÖÿ™ÿ±Ÿà", words_ar: ["ŸÇÿ∑ÿßÿ±", "ÿ±ÿµŸäŸÅ", "ÿ™ÿ∞ŸÉÿ±ÿ©", "ŸÜŸÅŸÇ"], loc_en: "Subway", words_en: ["Train", "Platform", "Ticket", "Tunnel"] },
            { loc_ar: "ÿ≥ÿ™ŸàÿØŸäŸà ÿ™ÿµŸàŸäÿ±", words_ar: ["ÿ•ÿ∂ÿßÿ°ÿ©", "ÿÆŸÑŸÅŸäÿ©", "ŸÉÿßŸÖŸäÿ±ÿß", "ŸÖŸàÿØŸäŸÑ"], loc_en: "Studio", words_en: ["Light", "Backdrop", "Camera", "Model"] },
            { loc_ar: "ŸÖÿµŸÑŸâ", words_ar: ["ÿ≥ÿ¨ÿßÿØÿ©", "ŸÇÿ®ŸÑÿ©", " Imam ", "ÿµŸÑÿßÿ©"], loc_en: "Mosque", words_en: ["Rug", "Qibla", "Imam", "Prayer"] },
            { loc_ar: "ŸÉŸÜŸäÿ≥ÿ©", words_ar: ["ÿ¨ÿ±ÿ≥", "ŸÖÿ∞ÿ®ÿ≠", "ŸÇÿ≥Ÿäÿ≥", "ÿµŸÑŸäÿ®"], loc_en: "Church", words_en: ["Bell", "Altar", "Priest", "Cross"] },
            { loc_ar: "ÿ≥ŸäŸÜŸÖÿß", words_ar: ["ÿ¥ÿßÿ¥ÿ©", "ŸÅÿ¥ÿßÿ±", "ÿ™ÿ∞ÿßŸÉÿ±", "ÿ∏ŸÑÿßŸÖ"], loc_en: "Cinema", words_en: ["Screen", "Popcorn", "Tickets", "Dark"] },
            { loc_ar: "ŸÖŸÑŸáŸâ ŸÑŸäŸÑŸä", words_ar: ["ŸÖŸàÿ≥ŸäŸÇŸâ", "ÿ±ŸÇÿµ", "ÿ®ÿßÿ±", "ÿ£ÿ∂Ÿàÿßÿ°"], loc_en: "Night Club", words_en: ["Music", "Dance", "Bar", "Lights"] },
            { loc_ar: "ŸÖŸÑÿßŸáŸä", words_ar: ["ÿ£ŸÑÿπÿßÿ®", "ŸÇÿ∑ÿßÿ±", "ŸÖÿ∑ÿ±", "ÿ™ÿ∞ÿßŸÉÿ±"], loc_en: "Carnival", words_en: ["Rides", "Train", "Cotton", "Tickets"] },
            { loc_ar: "ÿµŸäÿØŸÑŸäÿ©", words_ar: ["ÿØŸàÿßÿ°", "ŸàÿµŸÅÿ©", "ÿ∑ÿ®Ÿäÿ®", "ÿ±ŸÅŸàŸÅ"], loc_en: "Pharmacy", words_en: ["Medicine", "Rx", "Doctor", "Shelves"] },
            { loc_ar: "ŸÖÿ≥ÿ®ÿ≠", words_ar: ["ŸÖÿßÿ°", "ÿ∫ÿ∑ÿßÿ≥", "ÿ≠ŸÖÿßŸÖ", "ŸÉŸÑŸàÿ±"], loc_en: "Pool", words_en: ["Water", "Diver", "Swim", "Chlorine"] },
            { loc_ar: "ŸÜÿßÿØŸä ÿ±Ÿäÿßÿ∂Ÿä", words_ar: ["ÿ£ÿ´ŸÇÿßŸÑ", "ÿ¨ÿ±Ÿä", "ŸÖÿØÿ±ÿ®", "ÿπÿ∂ŸÑÿßÿ™"], loc_en: "Gym", words_en: ["Weights", "Run", "Trainer", "Muscles"] },
            { loc_ar: "ŸÖÿ±ŸÉÿ≤ ÿ™ÿ≥ŸàŸÇ", words_ar: ["ŸÖÿ≠ŸÑÿßÿ™", "ÿ≠ŸÇÿßÿ¶ÿ®", "ÿ∑ÿπÿßŸÖ", "ŸÖŸÖÿ±ÿßÿ™"], loc_en: "Mall", words_en: ["Shops", "Bags", "Food", "Halls"] },
            { loc_ar: "ŸÖŸÜÿßÿ±ÿ©", words_ar: ["ÿ∂Ÿàÿ°", "ÿ®ÿ≠ÿ±", "ÿ≥ŸÑŸÖ", "ÿ¨ÿ≤Ÿäÿ±ÿ©"], loc_en: "Lighthouse", words_en: ["Light", "Sea", "Stairs", "Island"] },
            { loc_ar: "Ÿàÿ±ÿ¥ÿ© ŸÜÿ¨ÿßÿ±ÿ©", words_ar: ["ÿÆÿ¥ÿ®", "ŸÖŸÜÿ¥ÿßÿ±", "ŸÖÿ∑ÿ±ŸÇÿ©", "ÿ∫ÿ®ÿßÿ±"], loc_en: "Workshop", words_en: ["Wood", "Saw", "Hammer", "Dust"] },
            { loc_ar: "ŸÖŸÉÿ™ÿ® ÿ™ÿ≠ŸÇŸäŸÇÿßÿ™", words_ar: ["ŸÖŸÑŸÅÿßÿ™", "ŸÖÿ≠ŸÇŸÇ", "ÿπÿØÿ≥ÿ©", "ÿ£ÿØŸÑÿ©"], loc_en: "Detective Office", words_en: ["Files", "Detective", "Lens", "Clues"] },
            { loc_ar: "ŸÇÿßÿ±ÿ® ÿµŸäÿØ", words_ar: ["ÿ¥ÿ®ŸÉÿ©", "ÿ≥ŸÖŸÉ", "ÿ®ÿ≠ÿ±", "ÿµŸÜÿßÿ±ÿ©"], loc_en: "Fishing Boat", words_en: ["Net", "Fish", "Sea", "Hook"] },
            { loc_ar: "ŸÖÿ≠ÿ∑ÿ© ÿ•ÿ∞ÿßÿπÿ©", words_ar: ["ŸÖÿßŸäŸÉ", "ÿ£ŸÜÿ™ŸäŸÜÿß", "ÿµŸàÿ™", "ÿ£ÿ∫ŸÜŸäÿ©"], loc_en: "Radio Station", words_en: ["Mic", "Antenna", "Voice", "Song"] },
            { loc_ar: "ŸÖÿ¥ŸÅŸâ ŸÑŸÑÿ£ŸÖÿ±ÿßÿ∂ ÿßŸÑŸÜŸÅÿ≥Ÿäÿ©", words_ar: ["ÿ¨ŸÜŸàŸÜ", "ÿ≠ÿ®Ÿàÿ®", "ÿ∑ÿ®Ÿäÿ®", "ŸÜÿπÿßÿ≥"], loc_en: "Mental Hospital", words_en: ["Mad", "Pills", "Doctor", "Sleep"] },
            { loc_ar: "ŸÖÿ≠ÿ∑ÿ© ÿ•ÿ∑ŸÅÿßÿ°", words_ar: ["ŸÜÿßÿ±", "ÿÆÿ±ÿ∑ŸàŸÖ", "ÿ≥Ÿäÿßÿ±ÿ©", "ÿ•ŸÜÿ∞ÿßÿ±"], loc_en: "Fire Station", words_en: ["Fire", "Hose", "Truck", "Alarm"] },
            { loc_ar: "ŸÖŸÉÿ™ÿ® ŸÖÿ≠ÿßŸÖÿßÿ©", words_ar: ["ŸÇÿßŸÜŸàŸÜ", "ŸÖŸÑŸÅÿßÿ™", "ŸÇÿßÿ∂Ÿä", "ÿØŸÅÿßÿπ"], loc_en: "Law Firm", words_en: ["Law", "Files", "Judge", "Defense"] }
        ];

        const EMOJIS = ['üïµÔ∏è', 'üîç', 'üö®', 'ü§ê', 'üëÄ', 'üî™', 'üõ°Ô∏è', 'üíÄ', 'ü§´', '‚úÖ'];
        const MAX_ROUNDS = 3;

        function App() {
            const [lang, setLang] = useState('en');
            const [user, setUser] = useState(null);
            const [room, setRoom] = useState(null);
            const [roomId, setRoomId] = useState('');
            const [inputCode, setInputCode] = useState('');
            const [nickname, setNickname] = useState(() => localStorage.getItem('pro_spy_nick') || '');
            const [loading, setLoading] = useState(false);
            const [chatMsg, setChatMsg] = useState('');
            const [voteTarget, setVoteTarget] = useState(null); 
            const [turnTimer, setTurnTimer] = useState(30);
            const [votingTimer, setVotingTimer] = useState(30);
            const [wordSelTimer, setWordSelTimer] = useState(30);
            const [soundEnabled, setSoundEnabled] = useState(true);
            
            const t = TRANSLATIONS[lang];

            // --- Background Logic ---
            useEffect(() => {
                const canvas = document.getElementById('bg-canvas');
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                let width, height, particles;
                let mouse = { x: null, y: null };
                const particleCount = 60;

                const resize = () => {
                    width = canvas.width = window.innerWidth;
                    height = canvas.height = window.innerHeight;
                };
                
                const handleMouseMove = (e) => {
                    mouse.x = e.clientX;
                    mouse.y = e.clientY;
                };

                window.addEventListener('resize', resize);
                window.addEventListener('mousemove', handleMouseMove);
                resize();

                class Particle {
                    constructor() {
                        this.x = Math.random() * width;
                        this.y = Math.random() * height;
                        this.vx = (Math.random() - 0.5) * 0.5;
                        this.vy = (Math.random() - 0.5) * 0.5;
                        this.size = Math.random() * 2;
                    }
                    update() {
                        this.x += this.vx;
                        this.y += this.vy;
                        if (this.x < 0 || this.x > width) this.vx *= -1;
                        if (this.y < 0 || this.y > height) this.vy *= -1;
                        
                        if (mouse.x != null) {
                            let dx = mouse.x - this.x;
                            let dy = mouse.y - this.y;
                            let dist = Math.sqrt(dx*dx + dy*dy);
                            if (dist < 150) {
                                const force = (150 - dist) / 150;
                                this.x -= dx * force * 0.02;
                                this.y -= dy * force * 0.02;
                            }
                        }
                    }
                    draw() {
                        ctx.fillStyle = 'rgba(0, 242, 255, 0.5)';
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }

                particles = Array.from({ length: particleCount }, () => new Particle());
                let animId;
                const animate = () => {
                    ctx.clearRect(0, 0, width, height);
                    ctx.strokeStyle = 'rgba(112, 0, 255, 0.1)';
                    ctx.lineWidth = 1;
                    
                    for (let i = 0; i < particles.length; i++) {
                        particles[i].update();
                        particles[i].draw();
                        
                        for (let j = i; j < particles.length; j++) {
                            let dx = particles[i].x - particles[j].x;
                            let dy = particles[i].y - particles[j].y;
                            let dist = Math.sqrt(dx*dx + dy*dy);
                            if (dist < 120) {
                                ctx.beginPath();
                                ctx.moveTo(particles[i].x, particles[i].y);
                                ctx.lineTo(particles[j].x, particles[j].y);
                                ctx.stroke();
                            }
                        }
                    }
                    animId = requestAnimationFrame(animate);
                };
                animate();

                return () => {
                    cancelAnimationFrame(animId);
                    window.removeEventListener('resize', resize);
                    window.removeEventListener('mousemove', handleMouseMove);
                };
            }, []); 

            // --- Auth Effect ---
            useEffect(() => {
                const unsub = auth.onAuthStateChanged(async (u) => {
                    if (u) setUser(u);
                    else await auth.signInAnonymously();
                });
                return unsub;
            }, []);

            // --- Room Listener ---
            useEffect(() => {
                if (!user || !roomId) return;
                const unsub = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId)
                    .onSnapshot(doc => {
                        if (doc.exists) setRoom(doc.data());
                        else setRoom(null);
                    });
                return unsub;
            }, [user, roomId]);

            // --- Turn Timer Logic ---
            useEffect(() => {
                if (room?.status === 'discussing' && room?.turnEndTime) {
                    const interval = setInterval(() => {
                        const remaining = Math.max(0, Math.floor((room.turnEndTime - Date.now()) / 1000));
                        setTurnTimer(remaining);
                        if (remaining <= 0) {
                            handleSkipTurn(true); 
                            clearInterval(interval);
                        }
                    }, 1000);
                    return () => clearInterval(interval);
                } else {
                    setTurnTimer(30);
                }
            }, [room?.status, room?.turnEndTime]);

            // --- Voting Timer Logic ---
            useEffect(() => {
                if (room?.status === 'voting' && room?.votingEndTime) {
                    const interval = setInterval(() => {
                        const remaining = Math.max(0, Math.floor((room.votingEndTime - Date.now()) / 1000));
                        setVotingTimer(remaining);
                        
                        if (remaining <= 0) {
                            resolveVotes(true);
                            clearInterval(interval);
                        }
                    }, 1000);
                    return () => clearInterval(interval);
                } else {
                    setVotingTimer(30);
                }
            }, [room?.status, room?.votingEndTime]);

            // --- Word Selection Timer Logic ---
            useEffect(() => {
                if (room?.status === 'word_selection' && room?.wordSelEndTime) {
                    const interval = setInterval(() => {
                        const remaining = Math.max(0, Math.floor((room.wordSelEndTime - Date.now()) / 1000));
                        setWordSelTimer(remaining);
                        
                        if (remaining <= 0) {
                            finishWordSelection(); // Force finish
                            clearInterval(interval);
                        }
                    }, 1000);
                    return () => clearInterval(interval);
                } else {
                    setWordSelTimer(30);
                }
            }, [room?.status, room?.wordSelEndTime]);

            // --- Actions ---

            const handleCreate = async () => {
                if (!nickname.trim() || !user) return;
                if (soundEnabled) playSound('click');
                setLoading(true);
                const id = Math.random().toString(36).substring(2, 7).toUpperCase();
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(id).set({
                    id, admin: user.uid, status: 'waiting',
                    players: [{ uid: user.uid, name: nickname, status: 'active' }],
                    scenario: null, spyId: null, 
                    currentTurnUID: null, turnEndTime: null, votingEndTime: null, currentRound: 0,
                    messages: [], votes: {}, usedLocations: [], 
                    wordVotes: {}, chosenWord: null, wordSelEndTime: null
                });
                setRoomId(id);
                setLoading(false);
            };

            const handleJoin = async () => {
                if (!nickname.trim() || !inputCode || !user) return;
                if (soundEnabled) playSound('click');
                setLoading(true);
                const ref = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(inputCode.toUpperCase());
                const snap = await ref.get();
                if (snap.exists) {
                    const data = snap.data();
                    const exists = data.players.find(p => p.uid === user.uid);
                    if (!exists) {
                        await ref.update({ players: [...data.players, { uid: user.uid, name: nickname, status: 'active' }] });
                    }
                    setRoomId(inputCode.toUpperCase());
                }
                setLoading(false);
            };

            const startGame = async () => {
                if (room.admin !== user.uid) return;
                if (soundEnabled) playSound('success');
                
                const used = room.usedLocations || [];
                const avail = SCENARIOS.filter(s => !used.includes(s.loc_en));
                const scenario = (avail.length > 0 ? avail : SCENARIOS)[Math.floor(Math.random() * (avail.length || SCENARIOS.length))];
                const activePlayers = room.players.filter(p => p.status === 'active');
                
                if (activePlayers.length < 3) { alert("Need at least 3 players!"); return; }

                const spy = activePlayers[Math.floor(Math.random() * activePlayers.length)];
                
                // Pick first player (Must NOT be Spy)
                let potentialStarters = activePlayers.filter(p => p.uid !== spy.uid);
                if (potentialStarters.length === 0) potentialStarters = activePlayers; // Fallback if everyone is spy (impossible but safe)
                const firstPlayer = potentialStarters[Math.floor(Math.random() * potentialStarters.length)];

                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({
                    status: 'word_selection', // New Phase
                    scenario, spyId: spy.uid,
                    currentTurnUID: firstPlayer.uid, 
                    turnEndTime: null, 
                    currentRound: 1, 
                    players: room.players.map(p => ({ ...p, vote: null })),
                    usedLocations: firebase.firestore.FieldValue.arrayUnion(scenario.loc_en),
                    messages: [], votes: {},
                    wordVotes: {}, chosenWord: null, 
                    wordSelEndTime: Date.now() + 30000 // 30s for word selection
                });
            };

            const submitWordVote = async (word) => {
                if (!user || !room || room.status !== 'word_selection') return;
                if (soundEnabled) playSound('click');
                
                // Logic: Vote for a word
                const voteUpdate = {};
                voteUpdate[`wordVotes.${user.uid}`] = word;
                
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update(voteUpdate);
            };

            const finishWordSelection = async (forced = false) => {
                if (!room || room.status !== 'word_selection') return;

                const freshSnap = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).get();
                const freshData = freshSnap.data();

                // Calculate majority word
                const counts = {};
                Object.values(freshData.wordVotes || {}).forEach(v => counts[v] = (counts[v] || 0) + 1);
                let maxCount = 0;
                let chosenWord = (lang === 'ar' ? freshData.scenario.words_ar[0] : freshData.scenario.words_en[0]);
                
                for (const w in counts) {
                    if (counts[w] > maxCount) {
                        maxCount = counts[w];
                        chosenWord = w;
                    }
                }

                // Transition to discussing
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({
                    status: 'discussing',
                    turnEndTime: Date.now() + 30000,
                    chosenWord: chosenWord,
                    wordSelEndTime: null
                });
            };

            const handleSkipTurn = async (forced = false) => {
                if (!room) return;
                if (!forced && room.currentTurnUID !== user.uid) return;
                if (forced && room.status !== 'discussing') return;
                nextTurn();
            };

            const nextTurn = async () => {
                if (!room) return;
                const activePlayers = room.players.filter(p => p.status === 'active');
                const currentIndex = activePlayers.findIndex(p => p.uid === room.currentTurnUID);
                const nextIndex = (currentIndex + 1) % activePlayers.length;

                if (nextIndex === 0) {
                    // Full circle, go to voting
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({
                        status: 'voting', currentTurnUID: null, turnEndTime: null,
                        votingEndTime: Date.now() + 30000 
                    });
                } else {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({
                        currentTurnUID: activePlayers[nextIndex].uid,
                        turnEndTime: Date.now() + 30000
                    });
                }
            };

            const sendMessage = async (text) => {
                if (!text.trim() || !user) return;
                if (soundEnabled) playSound('click');
                const msg = { sender: user.uid, name: nickname, text: text, time: Date.now() };
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({
                    messages: firebase.firestore.FieldValue.arrayUnion(msg)
                });
                setChatMsg('');
            };

            const submitVote = async (targetUID) => {
                if (!targetUID || !user || (room.votes && room.votes[user.uid])) return;
                if (soundEnabled) playSound('click');
                const voteUpdate = {};
                voteUpdate[`votes.${user.uid}`] = targetUID;
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update(voteUpdate);
            };

            const resolveVotes = async (forced = false) => {
                if (!room || room.status !== 'voting') return;
                
                const freshSnap = await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).get();
                const freshData = freshSnap.data();
                if (freshData.status !== 'voting') return;

                const activePlayers = freshData.players.filter(p => p.status === 'active');
                const votes = freshData.votes || {};
                
                const voteCounts = {};
                Object.values(votes).forEach(v => voteCounts[v] = (voteCounts[v] || 0) + 1);
                
                let maxVotes = 0; let ejectedUID = null; let isTie = false;
                for (const uid in voteCounts) {
                    if (voteCounts[uid] > maxVotes) { maxVotes = voteCounts[uid]; ejectedUID = uid; isTie = false; }
                    else if (voteCounts[uid] === maxVotes) { isTie = true; }
                }

                const majorityNeeded = Math.floor(activePlayers.length / 2) + 1;
                
                if (isTie || maxVotes < majorityNeeded) {
                    // Continue to next round logic
                    const nextRound = (freshData.currentRound || 1) + 1;
                    if (nextRound > MAX_ROUNDS) {
                        // Spy Wins if time runs out or no ejection after max rounds
                        await endGame(false); 
                    } else {
                        // Next Round
                        const firstPlayer = activePlayers.find(p => p.uid !== freshData.spyId) || activePlayers[0];
                        await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({
                            status: 'word_selection', 
                            votes: {}, 
                            currentRound: nextRound,
                            currentTurnUID: firstPlayer.uid, 
                            turnEndTime: null, 
                            votingEndTime: null,
                            wordVotes: {}, chosenWord: null, 
                            wordSelEndTime: Date.now() + 30000
                        });
                    }
                } else {
                    const newPlayers = freshData.players.map(p => {
                        if (p.uid === ejectedUID) return { ...p, status: 'spectator' };
                        return p;
                    });

                    const isSpy = ejectedUID === freshData.spyId;
                    const remainingAgents = newPlayers.filter(p => p.status === 'active' && p.uid !== freshData.spyId);

                    if (isSpy) { 
                        await endGame(true); // Agents Win
                    } else if (remainingAgents.length <= 1) { 
                        await endGame(false); // Spy Wins
                    } else {
                        // Continue with ejected spectator
                        const nextRound = (freshData.currentRound || 1) + 1;
                        if (nextRound > MAX_ROUNDS) {
                            await endGame(false);
                        } else {
                            const firstPlayer = newPlayers.filter(p => p.status === 'active').find(p => p.uid !== freshData.spyId) || newPlayers.filter(p => p.status === 'active')[0];
                             await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({
                                players: newPlayers, 
                                status: 'word_selection', 
                                votes: {},
                                currentTurnUID: firstPlayer.uid,
                                turnEndTime: null, 
                                votingEndTime: null,
                                currentRound: nextRound,
                                wordVotes: {}, chosenWord: null, 
                                wordSelEndTime: Date.now() + 30000
                            });
                        }
                    }
                }
            };

            const endGame = async (agentsWin) => {
                if (soundEnabled) playSound(agentsWin ? 'success' : 'fail');
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({
                    status: agentsWin ? 'finished_spy_caught' : 'finished_spy_wins',
                    turnEndTime: null, votingEndTime: null
                });
            };

            const resetGame = async () => {
                if (soundEnabled) playSound('click');
                await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('rooms').doc(roomId).update({
                    status: 'waiting', scenario: null, spyId: null, currentTurnUID: null, currentRound: 0,
                    votes: {}, messages: [], votingEndTime: null, turnEndTime: null,
                    players: room.players.map(p => ({ uid: p.uid, name: p.name, status: 'active' })),
                    wordVotes: {}, chosenWord: null, wordSelEndTime: null
                });
            };

            // --- Render Guard ---
            if (!user) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center space-y-4 animate-fade-in">
                            <div className="logo-container mx-auto animate-float">
                                <div className="logo-border"></div>
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" strokeWidth="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                                </svg>
                            </div>
                            <p className="text-gray-400 font-mono text-sm animate-pulse">{t.connecting}</p>
                        </div>
                    </div>
                );
            }

            // --- Render Helpers ---
            const isMyTurn = room?.currentTurnUID === user.uid;
            const isSpy = room?.spyId === user.uid;
            const me = room?.players?.find(p => p.uid === user.uid);
            const isSpectator = me?.status === 'spectator';
            const hasVoted = room?.votes?.[user.uid];
            const hasVotedWord = room?.wordVotes?.[user.uid];

            const timerProgress = (turnTimer / 30) * 100;
            const circumference = 2 * Math.PI * 18;
            const strokeDashoffset = circumference - (timerProgress / 100) * circumference;
            const smallCircumference = 2 * Math.PI * 10;
            const smallStrokeDashoffset = smallCircumference - ((turnTimer / 30) * 100 / 100) * smallCircumference;

            return (
                <div className="min-h-screen flex flex-col items-center p-4 md:p-6" dir={lang === 'ar' ? 'rtl' : 'ltr'}>
                    {/* Header */}
                    <header className="w-full max-w-4xl flex justify-between items-center mb-6 animate-fade-in">
                        <div className="flex items-center gap-3">
                            <div className="logo-container animate-float">
                                <div className="logo-border"></div>
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" strokeWidth="2">
                                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                                </svg>
                            </div>
                            <div>
                                <h1 className="game-title text-2xl">{t.appName}</h1>
                                <p className="text-[10px] text-gray-500 tracking-widest font-tech">{t.tagline}</p>
                            </div>
                        </div>
                        <div className="flex gap-2 items-center">
                            <a href="https://guessmycard.mooo.info/" target="_blank" rel="noopener noreferrer" className="btn-ghost px-3 py-1 rounded text-xs font-bold border-gray-700 hover:text-pink-400 hover:border-pink-400">
                                {t.linkGuessCard}
                            </a>
                            <button onClick={() => { initAudio(); setSoundEnabled(!soundEnabled); }} className="btn-ghost px-3 py-1 rounded text-xs font-bold border-gray-700">
                                {soundEnabled ? t.soundOn : t.soundOff}
                            </button>
                            <button onClick={() => setLang(lang === 'en' ? 'ar' : 'en')} className="btn-ghost px-4 py-1 rounded text-xs font-bold border-gray-700">
                                {t.langBtn}
                            </button>
                        </div>
                    </header>

                    <main className="w-full max-w-4xl grid grid-cols-1 md:grid-cols-3 gap-4">
                        
                        {/* Left Column: Players List - ONLY IF ROOM */}
                        {room && (
                            <div className="glass-panel rounded-2xl p-4 space-y-2 animate-fade-in delay-1">
                                <h3 className="text-xs font-bold text-gray-400 mb-2 border-b border-gray-800 pb-2 uppercase tracking-wider">{t.players}</h3>
                                <div className="space-y-2">
                                    {room.players.map((p, i) => (
                                        <div key={i} 
                                            className={`player-card relative p-2 rounded-lg flex items-center justify-between 
                                            ${p.uid === room.currentTurnUID && room.status === 'discussing' ? 'active' : 'border border-transparent'}
                                            ${p.status === 'spectator' ? 'eliminated' : ''}`}
                                        >
                                            {p.uid === room.currentTurnUID && room.status === 'discussing' && (
                                                <>
                                                    <svg className="player-timer-svg" viewBox="0 0 24 24">
                                                        <circle className="player-timer-bg" cx="12" cy="12" r="10"/>
                                                        <circle className="player-timer-progress" cx="12" cy="12" r="10"
                                                            strokeDasharray={smallCircumference} strokeDashoffset={smallStrokeDashoffset}
                                                        />
                                                    </svg>
                                                    <div className="player-timer-text">{turnTimer}</div>
                                                </>
                                            )}
                                            <div className="flex items-center gap-2 pl-5">
                                                <div className={`w-2 h-2 rounded-full ${p.status === 'spectator' ? 'bg-red-500' : 'bg-green-500'}`}></div>
                                                <span className="font-bold text-sm truncate">{p.name}</span>
                                                {p.uid === user.uid && <span className="text-[9px] bg-blue-500 px-1 rounded">{t.you}</span>}
                                            </div>
                                            <div>
                                                {p.status === 'spectator' && <span className="text-[9px] text-red-400">{t.spectator}</span>}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Middle Column: Main Game Area */}
                        <div className={`${room ? 'md:col-span-2' : 'md:col-span-3'} space-y-4`}>
                            
                            {/* Waiting / Setup Screen */}
                            {!room && (
                                <div className="glass-panel rounded-2xl p-8 text-center space-y-6 animate-fade-in mx-auto max-w-md w-full">
                                    <div className="space-y-2">
                                        <label className="text-xs text-gray-400 uppercase">{t.nickname}</label>
                                        <input className="input-dark w-full p-3 rounded-lg text-center font-bold" value={nickname} 
                                            onChange={e => { setNickname(e.target.value); localStorage.setItem('pro_spy_nick', e.target.value); }} 
                                        />
                                    </div>
                                    <button onClick={handleCreate} disabled={loading || !nickname} className="btn-neon w-full py-3 rounded-lg font-bold">
                                        {t.create}
                                    </button>
                                    <div className="flex gap-2">
                                        <input className="input-dark flex-1 p-3 rounded-lg text-center font-mono uppercase" placeholder={t.codePlaceholder} value={inputCode} onChange={e => setInputCode(e.target.value)} />
                                        <button onClick={handleJoin} disabled={loading || !nickname || !inputCode} className="btn-ghost px-6 rounded-lg font-bold">
                                            {t.join}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {room && (
                                <>
                                    {/* Room Info Bar */}
                                    <div className="glass-panel rounded-xl p-3 flex justify-between items-center">
                                        <div className="flex items-center gap-2">
                                            <span className="font-mono font-bold text-lg tracking-widest text-cyan-400">{room.id}</span>
                                            <button onClick={() => navigator.clipboard.writeText(room.id)} className="text-[10px] bg-white/10 px-2 py-1 rounded">Copy</button>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <span className="text-xs text-gray-400">{t.round}: {room.currentRound || 1}/{MAX_ROUNDS}</span>
                                            <span className="text-xs font-bold bg-white/10 px-2 py-1 rounded text-cyan-400">
                                                {room.status === 'word_selection' ? 'KEYWORD' : room.status === 'discussing' ? 'DISCUSSION' : room.status.toUpperCase()}
                                            </span>
                                        </div>
                                    </div>

                                    {/* Waiting for players */}
                                    {room.status === 'waiting' && (
                                        <div className="glass-panel rounded-2xl p-6 text-center animate-fade-in">
                                            <div className="animate-pulse text-gray-400 text-sm mb-4">{t.waiting}</div>
                                            {room.admin === user.uid && (
                                                <button onClick={startGame} className="btn-neon w-full py-3 rounded-lg font-bold">
                                                    {t.start}
                                                </button>
                                            )}
                                        </div>
                                    )}

                                    {/* Game Finished */}
                                    {(room.status === 'finished_spy_caught' || room.status === 'finished_spy_wins') && (
                                        <div className="glass-panel rounded-2xl p-8 text-center animate-fade-in border border-purple-500">
                                            <h2 className="text-3xl font-black mb-4 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                                                {room.status === 'finished_spy_caught' ? t.agentsWin : t.spyWin}
                                            </h2>
                                            <p className="text-gray-400 mb-6">
                                                The Spy was: <span className="text-white font-bold">{room.players.find(p => p.uid === room.spyId)?.name}</span>
                                            </p>
                                            {room.admin === user.uid && (
                                                <button onClick={resetGame} className="btn-ghost border-white/20 text-white w-full py-3 rounded-lg">
                                                    {t.playAgain}
                                                </button>
                                            )}
                                        </div>
                                    )}

                                    {/* Word Selection Phase */}
                                    {room.status === 'word_selection' && (
                                        <div className="space-y-4 animate-fade-in">
                                            <div className="glass-panel rounded-2xl p-6 text-center relative overflow-hidden border border-cyan-500/30">
                                                {/* Timer */}
                                                <div className="absolute top-4 right-4 w-12 h-12">
                                                    <svg className="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                                                        <circle cx="18" cy="18" r="16" fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth="3"></circle>
                                                        <circle 
                                                            cx="18" cy="18" r="16" 
                                                            fill="none" 
                                                            stroke="#00f2ff" 
                                                            strokeWidth="3"
                                                            strokeDasharray={`${(wordSelTimer/30)*100} ${100-((wordSelTimer/30)*100)}`}
                                                            strokeLinecap="round"
                                                        ></circle>
                                                    </svg>
                                                    <div className="absolute inset-0 flex items-center justify-center text-sm font-bold text-cyan-400">
                                                        {wordSelTimer}
                                                    </div>
                                                </div>

                                                <h3 className="text-xl font-black mb-2 uppercase text-cyan-400">{t.wordSelectionTitle}</h3>
                                                <p className="text-xs text-gray-500 mb-6">{t.wordSelectionDesc}</p>

                                                <div className="grid grid-cols-2 gap-4">
                                                    {(lang === 'ar' ? room.scenario?.words_ar : room.scenario?.words_en)?.map((word, i) => {
                                                        // Find who voted for this word
                                                        const voters = Object.entries(room.wordVotes || {})
                                                            .filter(([uid, w]) => w === word)
                                                            .map(([uid]) => room.players.find(p => p.uid === uid)?.name);
                                                        
                                                        return (
                                                            <button 
                                                                key={i} 
                                                                onClick={() => submitWordVote(word)}
                                                                className={`word-vote-card p-6 rounded-xl font-bold text-lg transition-all
                                                                    ${hasVotedWord === word ? 'selected' : 'bg-white/5 border border-white/10'}
                                                                `}
                                                            >
                                                                {word}
                                                                {voters.length > 0 && (
                                                                    <div className="flex justify-center gap-1 mt-2 flex-wrap">
                                                                        {voters.map(v => <span key={v} className="voter-name relative">{v}</span>)}
                                                                    </div>
                                                                )}
                                                            </button>
                                                        );
                                                    })}
                                                </div>

                                                {room.admin === user.uid && (
                                                    <button onClick={() => finishWordSelection(false)} className="btn-neon w-full py-3 rounded-lg font-bold mt-6">
                                                        {t.finishSelection}
                                                    </button>
                                                )}
                                            </div>

                                            {/* Identity Card (Show during selection too) */}
                                            <div className={`identity-square glass-panel ${isSpy ? 'identity-spy' : 'identity-agent'}`}>
                                                <div className="relative z-10 p-6 flex flex-col items-center justify-center h-full">
                                                    <span className={`text-[10px] font-bold uppercase tracking-widest mb-2 px-3 py-1 rounded-full ${isSpy ? 'bg-red-500/20 text-red-400' : 'bg-green-500/20 text-green-400'}`}>
                                                        {isSpy ? t.statusSpy : t.statusAgent}
                                                    </span>
                                                    {isSpy ? (
                                                        <>
                                                            <div className="text-5xl mb-2">üïµÔ∏è</div>
                                                            <h3 className="text-3xl font-black tracking-wider text-red-500">???</h3>
                                                        </>
                                                    ) : (
                                                        <>
                                                            <div className="text-3xl font-black mt-2 text-center px-2">
                                                                {lang === 'ar' ? room.scenario?.loc_ar : room.scenario?.loc_en}
                                                            </div>
                                                            <p className="text-xs text-gray-400 mt-2">{t.location}</p>
                                                        </>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {/* Discussion Phase */}
                                    {room.status === 'discussing' && (
                                        <div className="space-y-4 animate-fade-in">
                                            {/* Chosen Word Display */}
                                            {room.chosenWord && (
                                                <div className="glass-panel rounded-xl p-3 text-center border border-cyan-500/50">
                                                    <span className="text-[10px] text-cyan-400 font-bold uppercase">{t.selectedWord}:</span>
                                                    <span className="ml-2 text-lg font-bold text-white">{room.chosenWord}</span>
                                                </div>
                                            )}

                                            {/* Identity Card */}
                                            <div className={`identity-square glass-panel ${isSpy ? 'identity-spy' : 'identity-agent'}`}>
                                                <div className="relative z-10 p-6 flex flex-col items-center justify-center h-full">
                                                    <span className={`text-[10px] font-bold uppercase tracking-widest mb-2 px-3 py-1 rounded-full ${isSpy ? 'bg-red-500/20 text-red-400' : 'bg-green-500/20 text-green-400'}`}>
                                                        {isSpy ? t.statusSpy : t.statusAgent}
                                                    </span>
                                                    
                                                    {isSpy ? (
                                                        <>
                                                            <div className="text-5xl mb-2">üïµÔ∏è</div>
                                                            <h3 className="text-3xl font-black tracking-wider text-red-500">???</h3>
                                                            <p className="text-xs text-gray-500 mt-2 text-center">{lang === 'ar' ? 'ÿßŸÉÿ™ÿ¥ŸÅ ÿßŸÑŸÖŸÉÿßŸÜ ÿØŸàŸÜ ÿ£ŸÜ ÿ™ŸÜŸÉÿ¥ŸÅ' : 'Find the location without getting caught'}</p>
                                                        </>
                                                    ) : (
                                                        <>
                                                            <div className="text-4xl font-black mt-2 text-center px-2">
                                                                {lang === 'ar' ? room.scenario?.loc_ar : room.scenario?.loc_en}
                                                            </div>
                                                            <p className="text-xs text-gray-400 mt-2">{t.location}</p>
                                                        </>
                                                    )}
                                                </div>
                                            </div>

                                            {/* Chat Area */}
                                            <div className="glass-panel rounded-2xl p-4 flex flex-col overflow-hidden relative">
                                                {/* Big Timer */}
                                                <div className="absolute top-2 left-1/2 transform -translate-x-1/2 text-4xl font-mono font-bold text-cyan-400 opacity-30 pointer-events-none z-0">
                                                    {turnTimer}
                                                </div>

                                                <div className="chat-container space-y-2 mb-3 px-2 h-40 overflow-y-auto relative z-10 mt-8">
                                                    {room.messages?.slice(-20).map((m, i) => (
                                                        <div key={i} className={`flex w-full ${m.sender === user.uid ? 'justify-end' : 'justify-start'}`}>
                                                            <div className={m.sender === user.uid ? 'chat-bubble-me' : 'chat-bubble-other'}>
                                                                <div className="text-[10px] opacity-70 mb-1 font-bold">{m.name}</div>
                                                                <div className="text-sm leading-tight">{m.text}</div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                                
                                                {!isSpectator && isMyTurn ? (
                                                    <div className="flex flex-col gap-2 mt-auto border-t border-white/10 pt-3 relative z-10">
                                                        <div className="flex gap-1 mb-1">
                                                            {EMOJIS.map(emoji => (
                                                                <span key={emoji} onClick={() => sendMessage(emoji)} className="emoji-btn">{emoji}</span>
                                                            ))}
                                                        </div>
                                                        <form onSubmit={(e) => { e.preventDefault(); sendMessage(chatMsg); }} className="flex gap-2">
                                                            <input 
                                                                className="input-dark flex-1 p-3 rounded-xl text-sm" 
                                                                placeholder={t.chatPlaceholder} 
                                                                value={chatMsg} 
                                                                onChange={e => setChatMsg(e.target.value)} 
                                                            />
                                                            <button type="submit" className="btn-neon px-5 rounded-xl text-xs">{t.send}</button>
                                                            <button type="button" onClick={() => handleSkipTurn(false)} className="btn-ghost px-4 rounded-xl text-xs border-orange-500 text-orange-400">{t.skip}</button>
                                                        </form>
                                                    </div>
                                                ) : (
                                                    <div className="text-center text-xs text-gray-600 py-3 border-t border-white/10 mt-2">
                                                        {isSpectator ? t.spectator : "Waiting for turn..."}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {/* Voting Phase */}
                                    {room.status === 'voting' && (
                                        <div className="glass-panel rounded-2xl p-6 animate-fade-in space-y-4">
                                            <div className="flex justify-between items-center">
                                                <h3 className="text-lg font-bold text-yellow-400">{t.vote}</h3>
                                                <div className="relative w-10 h-10">
                                                    <svg className="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                                                        <circle cx="18" cy="18" r="16" fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth="3"></circle>
                                                        <circle 
                                                            cx="18" cy="18" r="16" 
                                                            fill="none" 
                                                            stroke="#ff0055" 
                                                            strokeWidth="3"
                                                            strokeDasharray={`${(votingTimer/30)*100} ${100-((votingTimer/30)*100)}`}
                                                            strokeLinecap="round"
                                                        ></circle>
                                                    </svg>
                                                    <div className="absolute inset-0 flex items-center justify-center text-[10px] font-bold text-yellow-400">
                                                        {votingTimer}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {!hasVoted ? (
                                                <>
                                                    <div className="grid grid-cols-2 gap-3">
                                                        {room.players.filter(p => p.status === 'active').map(p => (
                                                            <button key={p.uid} onClick={() => submitVote(p.uid)}
                                                                className={`p-4 rounded-xl border text-sm font-bold transition-all bg-white/5 border-white/10 hover:border-pink-400 hover:bg-pink-500/10`}
                                                            >
                                                                {p.name}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </>
                                            ) : (
                                                <div className="text-center space-y-4 py-4">
                                                    <div className="text-green-400 font-bold">{t.voteDone}</div>
                                                    <div className="text-xs text-gray-500">{t.voteWait}</div>
                                                </div>
                                            )}
                                        </div>
                                    )}
                                </>
                            )}
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
